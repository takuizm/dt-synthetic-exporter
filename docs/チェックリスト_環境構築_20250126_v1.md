# 環境構築チェックリスト
作成日: 2025-01-26  
用途: 初回セットアップ時の確認用  

## 事前準備チェック

### システム要件確認

- [ ] **OS**: macOS 10.14以上 または Windows 10以上
- [ ] **Python**: Python 3.8以上
- [ ] **ネットワーク**: インターネット接続
- [ ] **Dynatrace**: 有効なテナントアクセス
- [ ] **権限**: 管理者権限（ライブラリインストール用）

### ファイル確認

- [ ] `README.md` ファイルが存在
- [ ] `synthetic_browser_exporter.py` ファイルが存在  
- [ ] `requirements.txt` ファイルが存在
- [ ] `run_synthetic_exporter.sh` ファイルが存在
- [ ] `.env.template` ファイルが存在
- [ ] プロジェクトフォルダが完全にダウンロード済み

---

## 環境構築ステップ

### STEP 1: Python環境確認

#### 1-1. コマンドライン起動

**macOS:**
- [ ] **Finder** → **アプリケーション** → **ユーティリティ** → **ターミナル** を開く

**Windows:**
- [ ] **スタートメニュー** → **「cmd」と入力** → **コマンドプロンプト** を開く

#### 1-2. Pythonバージョン確認

**macOS:**
```bash
python3 --version
```

**Windows:**
```cmd
python --version
```

- [ ] `Python 3.8.x` 以上が表示される
- [ ] エラーが出ない

#### 1-3. Python が見つからない場合
- [ ] [Python公式サイト](https://www.python.org/downloads/)からダウンロード
- [ ] インストール完了後、ターミナル再起動
- [ ] 再度バージョン確認で成功

---

### STEP 2: プロジェクトフォルダ移動

#### 2-1. フォルダパス確認
```bash
pwd
```
- [ ] 現在のディレクトリを確認

#### 2-2. プロジェクトフォルダに移動
```bash
cd ~/Downloads/dt-synthetic-exporter
```
**または ドラッグ&ドロップで:**
```bash
cd 
```
(フォルダをターミナルにドラッグ)

#### 2-3. ファイル存在確認
```bash
ls -la
```
- [ ] `README.md` が表示される
- [ ] `synthetic_browser_exporter.py` が表示される  
- [ ] `requirements.txt` が表示される
- [ ] `run_synthetic_exporter.sh` が表示される
- [ ] `.env.template` が表示される

---

### STEP 3: Pythonライブラリインストール

#### 3-1. pip最新化（推奨）
```bash
pip3 install --upgrade pip
```
- [ ] エラーなく完了

#### 3-2. 依存ライブラリ一括インストール
```bash
pip3 install -r requirements.txt
```
- [ ] `requests` インストール成功
- [ ] `python-dotenv` インストール成功  
- [ ] `pytz` インストール成功
- [ ] `pandas` インストール成功

#### 3-3. インストール確認
```bash
python3 -c "import requests, pandas, pytz; print('全ライブラリ確認済')"
```
- [ ] `全ライブラリ確認済` と表示される

#### 3-4. インストール失敗時の個別対応
```bash
pip3 install requests>=2.28.0
pip3 install python-dotenv>=0.19.0  
pip3 install pytz>=2021.3
pip3 install pandas
```
- [ ] 各ライブラリが個別にインストール成功

---

### STEP 4: Dynatrace API設定

#### 4-1. APIトークン取得

**Dynatrace環境での作業:**
- [ ] Dynatraceテナントにログイン
- [ ] **Settings** メニューを開く
- [ ] **Integration** → **Dynatrace API** を選択
- [ ] **API tokens** を選択
- [ ] **Generate token** をクリック

**トークン設定:**
- [ ] **Token name**: `SyntheticExporter` を入力
- [ ] **Scopes** で以下にチェック:
  - [ ] `Read synthetic monitors`
  - [ ] `Read metrics`  
  - [ ] `Read entities`
- [ ] **Generate** をクリック
- [ ] **トークンをコピーして安全に保存**

#### 4-2. 環境設定ファイル作成

```bash
cp .env.template .env
```
- [ ] `.env` ファイルが作成される

#### 4-3. 設定ファイル編集

```bash
open .env
```
- [ ] テキストエディットが開く

**編集内容:**
```
DT_API_TOKEN=dt0c01.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
DT_ENV_URL=https://あなたのテナント.dynatrace.com
```

**編集チェック:**
- [ ] `DT_API_TOKEN=` の後にコピーしたAPIトークンを貼り付け
- [ ] `DT_ENV_URL=` の後にDynatraceテナントURLを入力
- [ ] **スペースなし、クォートなし**で入力
- [ ] **Command+S** で保存
- [ ] テキストエディットを閉じる

#### 4-4. 設定確認

```bash
cat .env
```
- [ ] APIトークンが正しく表示される
- [ ] 環境URLが正しく表示される
- [ ] 設定項目に余分なスペースがない

#### 4-5. 設定内容検証

```bash
python3 -c "
import os
from pathlib import Path
env_file = Path('.env')
if env_file.exists():
    with open(env_file, 'r') as f:
        for line in f:
            if '=' in line and not line.startswith('#'):
                key, value = line.strip().split('=', 1)
                if key == 'DT_API_TOKEN':
                    print(f'APIトークン: {value[:20]}...')
                elif key == 'DT_ENV_URL':  
                    print(f'環境URL: {value}')
else:
    print('.envファイルが見つかりません')
"
```

- [ ] `APIトークン: dt0c01...` と表示される
- [ ] `環境URL: https://xxx.dynatrace.com` と表示される

---

### STEP 5: 動作確認テスト

#### 5-1. 実行権限付与

```bash
chmod +x run_synthetic_exporter.sh
```
- [ ] エラーなく完了

#### 5-2. 接続テスト

```bash
python3 -c "
import os
from pathlib import Path
env_file = Path('.env')
if env_file.exists():
    with open(env_file, 'r') as f:
        for line in f:
            if '=' in line and not line.startswith('#'):
                key, value = line.strip().split('=', 1)
                os.environ[key] = value

import requests
api_token = os.getenv('DT_API_TOKEN')
env_url = os.getenv('DT_ENV_URL')
response = requests.get(f'{env_url}/api/v1/synthetic/monitors', 
                       headers={'Authorization': f'Api-Token {api_token}'})
if response.status_code == 200:
    monitors = response.json().get('monitors', [])
    browser_monitors = [m for m in monitors if m.get('type') == 'BROWSER']
    print(f'接続成功: Browser監視数 {len(browser_monitors)}')
else:
    print(f'接続エラー: {response.status_code}')
"
```

- [ ] `接続成功: Browser監視数 X` と表示される
- [ ] エラーメッセージが出ない

#### 5-3. 簡単テスト実行

```bash
python3 synthetic_browser_exporter.py --hours 1
```

- [ ] エラーなく実行開始
- [ ] `CSV出力: output/ultimate_browser_results_*.csv` と表示
- [ ] `サマリーレポート: output/ultimate_browser_results_*_summary.json` と表示

#### 5-4. 出力ファイル確認

```bash
ls -la output/
```

- [ ] `ultimate_browser_results_*.csv` ファイルが存在
- [ ] `ultimate_browser_results_*_summary.json` ファイルが存在

```bash
open output/ultimate_browser_results_*.csv
```

- [ ] CSVファイルがExcelで開く
- [ ] データが表示される
- [ ] 67種類のメトリクスが含まれている

---

## 最終確認チェック

### 環境確認
- [ ] Python 3.8以上がインストール済み
- [ ] 必要なライブラリが全てインストール済み
- [ ] `.env` ファイルが正しく設定済み
- [ ] Dynatrace API接続が成功

### 機能確認  
- [ ] ツールが正常に実行できる
- [ ] CSVファイルが出力される
- [ ] Excelでデータを開ける
- [ ] エラーなく動作完了

### 次のステップ準備
- [ ] 基本的な実行方法を理解
- [ ] よく使うオプションを把握
- [ ] トラブルシューティング方法を確認

---

## よくある失敗パターンと対策

### Python が見つからない
**症状**: `python3: command not found`  
**対策**: Python公式サイトからインストール

### ライブラリインストール失敗
**症状**: `ERROR: Could not install packages`  
**対策**: pip更新後、個別インストール実行

### API接続エラー
**症状**: `接続エラー: 401`  
**対策**: APIトークンの権限とURLを再確認

### 設定ファイルエラー
**症状**: `環境変数が設定されていません`  
**対策**: `.env`ファイルの内容と保存を再確認

### 権限エラー
**症状**: `Permission denied`  
**対策**: `chmod +x run_synthetic_exporter.sh` 実行

---

**全てのチェックが完了したら、本格的な分析を開始できます！** 